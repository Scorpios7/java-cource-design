<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <!--edge浏览器H5兼容设置-->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!--360浏览器H5兼容设置-->
    <meta name="renderer" content="webkit" />
    <title>电脑商城</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--导入核心文件-->
    <script src="../bootstrap3/js/holder.js"></script>
    <link href="../bootstrap3/css/bootstrap.css" rel="stylesheet" type="text/css">
    <script src="../bootstrap3/jquery-1.9.1.min.js"></script>
    <script src="../bootstrap3/js/bootstrap.js"></script>
    <!-- 字体图标 -->
    <script src="../bootstrap3/js/jquery.cookie.js" type="text/javascript" charset="utf-8"></script>
    <link rel="stylesheet" href="../bootstrap3/font-awesome-4.7.0/css/font-awesome.css" />
    <link rel="stylesheet" type="text/css" href="../css/layout.css" />
    <link rel="stylesheet" type="text/css" href="../css/top.css" />
    <link rel="stylesheet" type="text/css" href="../css/footer.css" />
    <link rel="stylesheet" type="text/css" href="../css/order.css" />
</head>

<body>
<!--头部-->
<header class="header">
    <!--电脑商城logo-->
    <div class="row">
        <div class="col-md-3">
            <a href="index.html">
                <img src="../images/index/logo.png" width="80" />
            </a>
        </div>
        <!--快捷选项-->
        <div class="col-md-9 top-item">
            <ul class="list-inline pull-right">
                <li><a href="favorites.html"><span class="fa fa-heart"></span>&nbsp;收藏</a></li>
                <li class="li-split">|</li>
                <li><a href="orders.html"><span class="fa fa-file-text"></span>&nbsp;订单</a></li>
                <li class="li-split">|</li>
                <li><a href="cart.html"><span class="fa fa-cart-plus"></span>&nbsp;购物车</a></li>
                <li class="li-split">|</li>
                <li>
                    <!--下列列表按钮 ：管理-->
                    <div class="btn-group">
                        <button type="button" class="btn btn-link dropdown-toggle" data-toggle="dropdown">
                            <span id="top-dropdown-btn"><span class="fa fa-gears"></span>&nbsp;管理 <span class="caret"></span></span>
                        </button>
                        <ul class="dropdown-menu top-dropdown-ul" role="menu">
                            <li><a href="password.html">修改密码</a></li>
                            <li><a href="userdata.html">个人资料</a></li>
                            <li><a href="address.html">收货管理	</a></li>
                        </ul>
                    </div>
                </li>
                <li class="li-split">|</li>
                <li><a href="login.html"><span class="fa fa-user"></span>&nbsp;用户名</a></li>
            </ul>
        </div>
    </div>
</header>
<!--导航 -->
<!--分割导航和顶部-->
<div class="row top-nav">
    <div class="col-md-6">
        <ul class="nav nav-tabs">
            <li>
                <a href="#"></a>
            </li>
            <li class="active"><a href="index.html"><span class="fa fa-heart"></span></a></li>
            <li><a href="#">秒杀</a></li>
            <li><a href="#">优惠券</a></li>
            <li><a href="#">电脑VIP</a></li>
            <li><a href="#">外卖</a></li>
            <li><a href="#">超市</a></li>
        </ul>
    </div>
    <div class="col-md-6">
        <form action="search.html" class="form-inline pull-right" role="form">
            <button type="submit" class="btn btn-default btn-lg"><span class="fa fa-search"></span></button>
        </form>
    </div>
</div>
<!--头部结束-->
<!--导航结束-->
<div class="container">
    <div class="col-md-2">
        <!--左侧导航开始-->
        <div class="panel-group" id="accordion">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <!--主选项：我的订单-->
                    <p class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne">我的订单</a>
                    </p>
                </div>
                <div id="collapseOne" class="panel-collapse collapse in">
                    <div class="panel-body">
                        <div><a href="orders.html">全部订单</a></div>
                        <div><a href="ordersPay.html"><b>待付款</b></a></div>
                        <div><a href="ordersProduct.html">待收货</a></div>
                        <div><a href="ordersComment.html">待评价</a></div>
                        <div><a href="ordersDone.html">已完成</a></div>
                    </div>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <!--主选项：资料修改-->
                    <p class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo">资料修改</a>
                    </p>
                </div>
                <div id="collapseTwo" class="panel-collapse collapse">
                    <div class="panel-body">
                        <div><a href="password.html"><b>修改密码</b></a></div>
                        <div><a href="userdata.html">个人资料</a></div>
                        <div><a href="address.html">收货管理</a></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--左侧导航结束-->
    <div class="col-md-10">
        <div id="order-list" class="panel panel-default">
            <div class="panel-heading">
                <!--						<p class="panel-title">-->
                <!--							订单号：1101000001，下单时间：2018-12-1 17:50:30 ，收货人：八戒-->
                <div id="order-info" class="panel-title">订单号：1101000301，下单时间：2018-12-1 17:50:30，<b>TUST电脑商城</b> </div>
                <!--						</p>-->
            </div>
            <div class="panel-body">
                <table class="orders-table" width="100%">
                    <thead>
                    <tr>
                        <th width="15%"></th>
                        <th width="30%">商品</th>
                        <th width="8%">单价</th>
                        <th width="8%">数量</th>
                        <th width="9%">小计</th>
                        <th width="10%">售后</th>
                        <th width="10%">状态</th>
                    </tr>
                    </thead>
                    <tbody id="order-product-list" class="orders-body">
                    <tr>
                        <td><img src="../images/portal/12DELLXPS13-silvery/collect.png" class="img-responsive" /></td>
                        <td>联想(Lenovo)小新Air13 Pro 13.3英寸14.8mm超轻薄笔记本电脑</td>
                        <td>¥<span>5298</span></td>
                        <td>1件</td>
                        <td>¥<span>5298</span></td>
                        <td><a href="#">申请售后</a></td>
                        <td>
                            <div>已发货</div>
                            <div><a href="orderInfo.html">订单详情</a></div>
                        </td>
                    </tr>
                    <tr>
                        <td><img src="../images/portal/16LenovoYOGA900green/collect.png" class="img-responsive" /></td>
                        <td>戴尔(DELL)XPS13-9360-R1609 13.3</td>
                        <td>¥<span>4696</span></td>
                        <td>2件</td>
                        <td>¥<span>9392</span></td>
                        <td><a href="#">申请售后</a></td>
                        <td>
                            <div>已发货</div>
                            <div><a href="orderInfo.html">订单详情</a></div>
                        </td>
                        <td><a href="#" class="btn btn-default btn-xs">确认收货</a></td>
                        <td><a href="comment.html" class="btn btn-default btn-xs">评论</a></td>
                    </tr>
                    <tr>
                        <td><img src="../images/portal/13LenovoIdeaPad310_silvery/collect.png" class="img-responsive" /></td>
                        <td>戴尔(DELL)魔方15MF Pro-R2505TSS灵越</td>
                        <td>¥<span>5999</span></td>
                        <td>1件</td>
                        <td>¥<span>5999</span></td>
                        <td><a href="#">申请售后</a></td>
                        <td>
                            <div>已发货</div>
                            <div><a href="orderInfo.html">订单详情</a></div>
                        </td>
                    </tr>
                    </tbody>
                </table>
                <div>
                    <span class="pull-right">订单总金额：¥20689</span>
                    <span class="pull-right"><a href="#" class="btn btn-default btn-lg">支付</a></span>
                </div>
            </div>
        </div>
    </div>
</div>

<!--页脚开始-->
<footer class="footer">
    <!-- 品质保障，私人定制等-->
    <div class="text-center rights container">
        <div class="col-md-offset-2 col-md-2">
            <span class="fa fa-diamond"></span>
            <p>品质保障</p>
        </div>
        <div class="col-md-2">
            <span class="fa fa-pencil-square-o"></span>
            <p>私人订制</p>
        </div>
        <div class="col-md-2">
            <span class="fa fa-graduation-cap"></span>
            <p>学生特供</p>
        </div>
        <div class="col-md-2">
            <span class="fa fa-thumbs-o-up"></span>
            <p>专属特权</p>
        </div>
    </div>
    <!--联系我们、下载客户端等-->
    <div class="container beforeBottom">
        <div class="col-md-offset-1 col-md-2">
            <div><img src="../images/index/downlogo.png" width="80" alt="" class="footLogo" /></div>
        </div>
        <div class="col-md-5 callus text-center">
            <div class="col-md-4">
                <ul>
                    <li><a href="#">买家帮助</a></li>
                    <li><a href="#">新手指南</a></li>
                    <li><a href="#">服务保障</a></li>
                </ul>
            </div>
            <div class="col-md-4">
                <ul>
                    <li><a href="#">商家帮助</a></li>
                    <li><a href="#">商家入驻</a></li>
                    <li><a href="#">商家后台</a></li>
                </ul>
            </div>
            <div class="col-md-4">
                <ul>
                    <li><a href="#">关于我们</a></li>
                    <li><a href="#">关于商城</a></li>
                    <li><a href="#">联系我们</a></li>        
                </ul>
            </div>
        </div>
        <div class="col-md-4">
            <ul>
                <li><a href="#">常见问题</a></li>
                <li>
                    <span class="fa fa-wechat"></span>
                    <span class="fa fa-weibo"></span>
                </li>
            </ul>               
        </div>
    </div>
</footer>
<!--页脚结束-->

<script type="text/javascript">
    $(document).ready(function () {
        showOrder();
        showInfo();
    });
    //输出订单全部信息
    function showOrder() {
        $.ajax({
            url: "/orders/get_wait_for_pay_orders/",
            dataType: "JSON",
            type:"GET",
            success:function (json) {
                if (json.state==200)
                {
                    let list = json.data;
                    $("#order-list").empty();
                    for (let i=0;i<list.length;i++)
                    {
                        let trs='<div class="panel-heading">\n' +
                            '<p class="panel-title">\n' +
                            '订单号：#{oid}，下单时间：#{createdTime}， 收货人：#{recvName}\n'  +
                            '</p>\n' +
                            '</div>\n' +
                            '<div class="panel-body">\n' +
                            '<table class="orders-table" width="100%">\n' +
                            '<thead>\n' +
                            '<tr>\n' +
                            '<th width="15%"></th>\n' +
                            '<th width="30%">商品</th>\n' +
                            '<th width="8%">单价</th>\n' +
                            '<th width="8%">数量</th>\n' +
                            '<th width="9%">小计</th>\n' +
                            '<th width="10%">售后</th>\n' +
                            '<th width="10%">状态</th>\n' +
                            '</tr>\n' +
                            '</thead>\n' +
                            '<tbody id="order-product-list-#{oid1}" class="orders-body">\n' +
                            '</tbody>\n' +
                            '</table>\n' +
                            '<div>\n' +
                            '<span class="pull-right"><a href="orderItemsPay.html?oid=#{oid}" class="btn btn-primary btn-sm">支付</a></span>' +
                            '<span class="pull-right">订单总金额：¥#{totalPrice}</span>\n' +
                            '</div>\n' +
                            '</div>';
                        trs = trs.replace(/#{totalPrice}/g, list[i].totalPrice);
                        trs = trs.replace(/#{createdTime}/g, crtTimeFtt(list[i].createdTime));
                        trs = trs.replace(/#{recvName}/g, list[i].recvName);
                        trs = trs.replace(/#{oid}/g, list[i].oid);
                        trs = trs.replace(/#{oid1}/g, list[i].oid);
                        $("#order-list").append(trs);
                        showOrderInfo(list[i].oid);
                    }
                }
            },
            error:function (xhr) {
                alert("您的登录信息已经过期，请重新登录！HTTP响应码：" + xhr.status);
                location.href = "login.html";
            }
        })
    }
    // //创建时间格式化显示
    function dateFtt(fmt,date)
    { //author: meizz
        var o = {
            "M+" : date.getMonth()+1,                 //月份
            "d+" : date.getDate(),                    //日
            "h+" : date.getHours(),                   //小时
            "m+" : date.getMinutes(),                 //分
            "s+" : date.getSeconds(),                 //秒
            "q+" : Math.floor((date.getMonth()+3)/3), //季度
            "S"  : date.getMilliseconds()             //毫秒
        };
        if(/(y+)/.test(fmt))
            fmt=fmt.replace(RegExp.$1, (date.getFullYear()+"").substr(4 - RegExp.$1.length));
        for(var k in o)
            if(new RegExp("("+ k +")").test(fmt))
                fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : (("00"+ o[k]).substr((""+ o[k]).length)));
        return fmt;
    }
    //创建时间格式化显示
    function crtTimeFtt(value,row,index)
    {
        var crtTime = new Date(value);
        return top.dateFtt("yyyy-MM-dd hh:mm:ss",crtTime);//直接调用公共JS里面的时间类处理的办法
    }
    //输出订单商品信息
    function showOrderInfo(oid) {
        $.ajax({
            url: "/orders/get_orderItems/"+ oid,
            data: {
                oid:oid
            },
            dataType: "JSON",
            type:"POST",
            success:function (json) {
                if (json.state==200)
                {
                    let list = json.data;
                    for (let i=0;i<list.length;i++)
                    {
                        let tr = '<tr>\n' +
                            '<td><a href="product.html?id=#{id}"><img src="..#{image}collect.png" class="img-responsive" /></td>\n' +
                            '<td><a href="product.html?id=#{id}">#{title}</td>\n' +
                            '<td>¥<span>#{price}</span></td>\n' +
                            '<td>#{num}件</td>\n' +
                            '<td>¥<span>#{itemTotalPrice}</span></td>\n' +
                            '<td><a href="#">申请售后</a></td>\n' +
                            '<td>\n' +
                            '<div>#{status}</div>\n' +
                            '<div><a href="orderInfo.html">订单详情</a></div>\n' +
                            '</td>\n' +
                            '</tr>';
                        tr = tr.replace(/#{pid}/g, list[i].pid);
                        tr = tr.replace(/#{id}/g, list[i].pid);
                        tr = tr.replace(/#{image}/g, list[i].image);
                        tr = tr.replace(/#{title}/g, list[i].title);
                        tr = tr.replace(/#{price}/g, list[i].price);
                        tr = tr.replace(/#{status}/g,"待付款");
                        tr = tr.replace(/#{num}/g, list[i].num);
                        tr = tr.replace(/#{oid}/g, list[i].oid);
                        tr = tr.replace(/#{itemTotalPrice}/g, list[i].num*list[i].price);
                        //获取动态创建的订单商品列表
                        $("#order-product-list-"+oid).append(tr);
                    }}},
            error:function (xhr) {
                alert("您的登录信息已经过期，请重新登录！HTTP响应码：" + xhr.status);
                location.href = "login.html";
            }
        })
    }
    //填充用户信息
    function showInfo()
    {
        // let avatar=$.cookie("avatar");
        $("#title-img-avatar").attr("src",$.cookie("avatar"));

        // let username=$.cookie("username");
        $("#title-user>b").text($.cookie("username"));
    }
</script>

</body>

</html>